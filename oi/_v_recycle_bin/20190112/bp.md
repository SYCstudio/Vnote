# bp
根据$lcm(i,j)=\frac{ij}{gcd(i,j)}$，式子可以化为 $Ans=\sum _ {i=1}^{n} \sum _ {j=1}^{m} \frac{ij}{gcd(i,j)}$ 令$d=gcd(i,j)$，把$d$提出来，即变成枚举$d$。 $Ans=\sum _ {d=1}^{n} \sum _ {i=1}^{n} \sum _ {j=1}^{m} [gcd(i,j)==d] * \frac{ij}{d}$ [ ]里面有$d$，把它提出来。后面的$i,j$相当于都提取出一个公因子$d$，变成$\frac{i}{d},\frac{j}{d}$ $Ans=\sum _ {d=1}^{n} \sum _ {i=1}^{n/d} \sum _ {j=1}^{m/d} [gcd(i,j)==1] * dij \\ Ans=\sum _ {d=1}^{n} d * \sum _ {i=1}^{n/d} \sum _ {j=1}^{m/d} [gcd(i,j)==1] * ij$ 前面先不管它，先看后面这一部分 设$f(x)=\sum _ {i=1}^{n/d} \sum _ {j=1}^{m/d} [gcd(i,j)==x] * ij$。设$g(x)=\sum _ {x|t} f(t)$ $g(x)=\sum _ {i=1}^{n/d} \sum _ {j=1}^{m/d} [x|gcd(i,j)]* ij $ 提一个$x$出来 $g(x)=\sum _ {i=1}^{n/d/x} \sum _ {j=1}^{m/d/x} [1|gcd(i,j)] i*x *j*x$ $[1|gcd(i,j)]$是显然成立的。所以 $g(x)=x^2*\sum _ {i=1}^{n/d/x} \sum _ {j=1}^{m/d/x} ij$ 那么这就是两个等差数列相乘了，可以$O(1)$地做 根据莫比乌斯反演 $f(x)=\sum _ {x|t}^{n/d} \mu(\frac{t}{x}) g(t) \\ = \sum _ {x|t}^{n/d} \mu(\frac{t}{x}) t^2 \sum _ {i=1}^{n/d/t} \sum _ {j=1}^{m/d/t} ij$ 由于我们要求的是$f(1)$ 所以得到$f(1)=\sum _ {k=1}^{n/d} \mu(k) k^2 \sum _ {i=1}^{n/d/k} \sum _ {j=1}^{m/d/k} ij$ 把$f(1)$代回到$Ans$ $Ans=\sum _ {d=1}^{n} \sum _ {k=1}^{n/d} \mu(k) * k^2 \sum _ {i=1}^{n/d/k} \sum _ {j=1}^{m/d/k} ij$ 内外两层数论分块，可以做到总复杂度$O(n)$ 