# [SDOI2010]地精部落
[BZOJ1925 Luogu2467]

传说很久以前，大地上居住着一种神秘的生物：地精。  
地精喜欢住在连绵不绝的山脉中。具体地说，一座长度为N的山脉H可分为从左到右的N段，每段有一个独一无二的高度Hi，其中Hi是1到N之间的正整数。  
如果一段山脉比所有与它相邻的山脉都高，则这段山脉是一个山峰。位于边缘的山脉只有一段相邻的山脉，其他都有两段（即左边和右边）。  
类似地，如果一段山脉比所有它相邻的山脉都低，则这段山脉是一个山谷。  
地精们有一个共同的爱好——饮酒，酒馆可以设立在山谷之中。地精的酒馆不论白天黑夜总是人声鼎沸，地精美酒的香味可以飘到方圆数里的地方。  
地精还是一种非常警觉的生物，他们在每座山峰上都可以设立瞭望台，并轮流担当瞭望工作，以确保在第一时间得知外敌的入侵。  
地精们希望这N段山脉每段都可以修建瞭望台或酒馆的其中之一，只有满足这个条件的整座山脉才可能有地精居住。  
现在你希望知道，长度为N的可能有地精居住的山脉有多少种。两座山脉A和B不同当且仅当存在一个i，使得Ai≠Bi。由于这个数目可能很大，你只对它除以P的余数感兴趣。

一个排列中满足任意一个位置要么小于它两边的数要么大于它两边的数，这样的序列有一些性质。首先，把每一个数变成 n-Ai+1 之后仍然是一个波动序列并且波峰和波谷互换，若 j 与 j+1 不相邻那么交换 j 和 j+1 两个值所在的位置仍然为一个波动序列。设 F[i][j] 表示前 i 个数中最后一个数是 j 且为峰的方案数，那么考虑 j 与 j-1 是否相邻分别转移。当 j 与 j-1 不相邻时，由于最后一个一定是山峰，所以交换 j 与 j-1 一定能够得到一个合法的解，这部分的贡献是 F[i][j-1] ；当 j 与 j-1 相邻时，由于 j 是山峰，那么 j-1 一定是前 i-1 的最后一个且为山谷，由交换的性质可以得到这部分的贡献应该是 F[i-1][i-j+1] 。

```cpp
#include<cstdio>
#include<cstdlib>
#include<cstring>
using namespace std;

#define mem(Arr,x) memset(Arr,x,sizeof(Arr))

const int maxN=4300;

int n,P;
int F[2][maxN];

int main(){
	scanf("%d%d",&n,&P);
	F[0][1]=1;int now=0;
	for (int i=1;i<=n;i++){
		now^=1;mem(F[now],0);
		for (int j=1;j<=i;j++) F[now][j]=(F[now][j-1]+F[now^1][i-j+1])%P;
	}
	int sum=0;
	for (int i=1;i<=n;i++) sum=(sum+F[now][i])%P;
	printf("%d\n",(sum+sum)%P);
	return 0;
}
```